//
//  CalculateTool.m
//  BodyScaleProduction
//
//  Created by 张诚亮 on 14-4-21.
//  Copyright (c) 2014年 Go Salo. All rights reserved.
//

#import "CalculateTool.h"
#import "Helpers.h"
#import "DatabaseService.h"
#import "PCEntity.h"

@implementation CalculateTool


+ (int)convertToInt:(NSString *)strtemp {
    
    int strlength = 0;
    char *p = (char *)[strtemp cStringUsingEncoding:NSUnicodeStringEncoding];
    for (int i=0 ; i<[strtemp lengthOfBytesUsingEncoding:NSUnicodeStringEncoding] ;i++) {
        if (*p) {
            p++;
            strlength++;
        } else {
            p++;
        }
    }
    return (strlength+1)/2;
}



#pragma mark - 辅助
+(NSString *)inputStr:(id)ipStr
{
    NSString *_result = @"";
    
    if (ipStr == nil || ipStr == NULL) {
        return _result ;
    }
    if ([ipStr isKindOfClass:[NSNull class]]) {
        return _result;
    }
    
    if ([ipStr isKindOfClass:[NSString class]]) {
        _result = ipStr;
    }
    
    if ([ipStr isKindOfClass:[NSNumber class]]) {
        _result = [(NSNumber *)ipStr stringValue];
    }
    
    return _result;
}


+(BOOL)checkData:(UserDataEntity *)ude
{
    BOOL _flag = NO;
    UserDataEntity *_lastData = [[DatabaseService defaultDatabaseService]
                                 getUserDataByUid:ude.UD_userId
                                 num:1];
    if (_lastData) {
        
        float _oldW = [ [CalculateTool inputStr:_lastData.UD_WEIGHT]  floatValue];
        float _oldF = [ [CalculateTool inputStr:_lastData.UD_FAT]  floatValue];
        float _newW = [ [CalculateTool inputStr:ude.UD_WEIGHT]  floatValue];
        float _newF = [ [CalculateTool inputStr:ude.UD_FAT]  floatValue];
        
        
        
        if ( fabsf((_oldW - _newW)) <= 2.5 ) {
            if ( fabsf((_oldF - _newF)) <= 30 ) {
                _flag = YES;
            }
        }
        
    }else{
        _flag = YES;
    }
    
    
    return _flag;
}


#pragma mark - function

+(void)calculateFixMaxList:(NSMutableArray *)maxList
                   minList:(NSMutableArray *)minList
{
    float _maxFixRate = 1.1;
    float _minFixRate = 0.9;
    
    for (int i = 0; i < maxList.count; i++) {
        NSNumber *_num = maxList[i];
        
        
        maxList[i] =  [NSNumber numberWithInt:ceilf( [_num intValue] * _maxFixRate )]  ;
    }
    
    
    for (int i = 0; i < minList.count; i++) {
        NSNumber *_num = minList[i];
        
        
        minList[i] =  [NSNumber numberWithInt:floorf( [_num intValue] * _minFixRate )]  ;
    }
    
}


+(float)calculateBMIWith:(float)weight
                  height:(float)height
{
    float _bmi = 0;
    if (height > 0)
    {
        _bmi =  weight / ( height * height);
    }
    else{
        _bmi = 0;
    }
    
    return _bmi;
}

/**
 *  计算BMI
 *
 *  @param user 用户信息对象
 *
 *  @return BMI值 若 height <= 0 BMI为 0
 */
+(float)calculateBMIWithUserInfo:(UserInfoEntity *)user
{
    float _bmi = 0;
    if (user) {
        if (user.UI_lastUserData) {
            
            float _w = 0;
            float _h = 0;
            
            if (user.UI_lastUserData.UD_WEIGHT && ![user.UI_lastUserData.UD_WEIGHT isEqual:[NSNull null]]) {
                _w = [user.UI_lastUserData.UD_WEIGHT floatValue];
            }
            if (user.UI_height && ![user.UI_height isEqual:[NSNull null]]) {
                _h = [user.UI_height floatValue];
            }
            
            if (_h > 0)
            {
                _bmi =  _w / ( _h * _h / 10000.0);
            }
            else{
                _bmi = 0;
            }
        }
    }
    return _bmi;
}


/**
 *  计算BMR
 *
 *  @param user 用户信息对象
 *
 *  @return BMR值 
 */

+(float)calculateBMRWithUserInfo:(UserInfoEntity *)user
{
    float _standard = 0;
    if (user) {
        
        if (user.UI_age && ![user.UI_age isEqual:[NSNull null]]) {
            int age     = [user.UI_age intValue];
            
            if (user.UI_lastUserData &&
                user.UI_lastUserData.UD_WEIGHT &&
                ![user.UI_lastUserData.UD_WEIGHT isEqual:[NSNull null]])
            {
                float _weight = [user.UI_lastUserData.UD_WEIGHT floatValue];
                
                
                if (age >= 10 && age < 18) {
                    _standard = 17.5 * _weight + 651;
                }
                else if (age >= 18 && age < 30) {
                    _standard = 15.3 * _weight + 679;
                }
                else if (age >= 30) {
                    _standard = 11.6 * _weight + 879;
                }
            }
            
            
        }
        
    }
    
    return _standard;
}


/**
 *  计算BMR (亚洲标准)
 *
 *  @param user 用户信息对象
 *
 *  @return BMI值
 */

+(float)calculateAsiaBMRWithUserInfo:(UserInfoEntity *)user
{
    float _standard = 0;
    if (user) {
        int age     = [[CalculateTool inputStr:user.UI_age] intValue];
        int sex     = [[CalculateTool inputStr:user.UI_sex] intValue];
        if (age <= 11
            ) {
            if (sex) {
                _standard = 1330;
            }else{
                _standard = 1200;
            }
        }
        else if (age >= 12 &&
                 age <= 14
                 ) {
            if (sex) {
                _standard = 1490;
            }else{
                _standard = 1360;
            }
        }
        else if (age >= 15 &&
                 age <= 17
                 ) {
            if (sex) {
                _standard = 1580;
            }else{
                _standard = 1280;
            }
        }
        else if (age >= 18 &&
                 age <= 29
                 ) {
            if (sex) {
                _standard = 1510;
            }else{
                _standard = 1120;
            }
        }
        else if (age >= 30 &&
                 age <= 49
                 ) {
            if (sex) {
                _standard = 1530;
            }else{
                _standard = 1150;
            }
        }
        else if (age >= 50 &&
                 age <= 69
                 ) {
            if (sex) {
                _standard = 1400;
            }else{
                _standard = 1110;
            }
        }
        else if (age >= 70 ) {
            if (sex) {
                _standard = 1280;
            }else{
                _standard = 1010;
            }
        }
    }
        
    
        

    
    return _standard;
}


/**
 *  计算RyFit指数
 *
 *  @param user 目标用户对象
 *  @param data 测量数据
 *
 *  @return RyFit指数   -1为异常(不再0～100之间）
 */
+(float)calculateRyFitWithUserInfo:(UserInfoEntity *)user
                              data:(UserDataEntity *)data
{

    float _result = -1;

    if (user && data) {
        int _age        = [[CalculateTool inputStr:user.UI_age] intValue];
        int _bodyAge    = [[CalculateTool inputStr:data.UD_BODYAGE] intValue];
        float _off      = [[CalculateTool inputStr:data.UD_OFFALFAT] floatValue];
        float _bmi      = [[CalculateTool inputStr:data.UD_BMI] floatValue];
        
        if (_bodyAge != 0 &&
            _off     != 0 &&
            _bmi     != 0 )
        {
            if (![@"" isEqualToString:[CalculateTool inputStr:data.UD_BODYAGE]])
            {
                
                int _ageNum = 85 + (_age - _bodyAge) * 2;

                if (![@"" isEqualToString:[CalculateTool inputStr:data.UD_OFFALFAT]]) {
                    
                    float _offNum = 100 - _off * 4.0;

                    if (![@"" isEqualToString:[CalculateTool inputStr:data.UD_BMI]]) {
                        
                        
                        float _bmiNum = 0 ;
                        
                        if (_bmi < 18) {
                            _bmiNum = 100 - 3.0 * 2 - (18 - _bmi) * 5.0;
                        }
                        else if (_bmi >= 18 && _bmi <= 24){
                            _bmiNum = 100 - fabs(_bmi - 20) * 3.0;
                        }
                        else if (_bmi > 24){
                            _bmiNum = 100 - 3.0 * 4 - (_bmi - 24) * 5.0;

                        }

                        float _ryfit =  0.2 * _offNum +
                                        0.3 * _bmiNum +
                                        0.5 * _ageNum;
                        
                        
                        if (_ryfit >= 0 && _ryfit <= 100) {
                            _result = _ryfit;
                        }
                        
                    }
                }
   
            }
            
        }
    }
    

    
    return [[NSString stringWithFormat:@"%.1f",_result] floatValue];
}

+(void)calculateMaxNumber:(NSMutableArray *)maxNumList
                  numbers:(NSArray *)numberList
{
    /*  默认值 同时也是 修正值 */
    NSArray *_aryD = @[@20,@20,@20,
                       @20,@10,@40,
                       @40,@600,@600,
                       @20,@20 ];
    /*  单位值  */
    NSArray *_aryU = @[
                       @10,@10,@10,
                       @10,@10,@10,
                       @10,@100,@100,
                       @10,@20 ];
    
    for (int i = 0; i < _aryD.count; i++) {
        maxNumList[i] = [NSNumber numberWithInt:
                         [CalculateTool calculateMaxValueByOValue:[maxNumList[i] floatValue]
                                                           tValue:[numberList[i] floatValue]
                                                         addValue:[_aryD[i] floatValue]
                                                           uValue:[_aryU[i] intValue] ] ];
    }
    
    /*
    maxNumList[0] = [NSNumber numberWithInt:
                   [CalculateTool calculateMaxValueByOValue:[maxNumList[0] floatValue]
                                                     tValue:_w
                                                   addValue:20 uValue:10]];
    maxNumList[1] = [NSNumber numberWithInt:
                   [CalculateTool calculateMaxValueByOValue:[maxNumList[1] floatValue]
                                                     tValue:_bmi
                                                   addValue:20 uValue:10]];
    maxNumList[2] = [NSNumber numberWithInt:
                   [CalculateTool calculateMaxValueByOValue:[maxNumList[2] floatValue]
                                                     tValue:_f
                                                   addValue:20 uValue:10]];
    maxNumList[3] = [NSNumber numberWithInt:
                   [CalculateTool calculateMaxValueByOValue:[maxNumList[3] floatValue]
                                                     tValue:_s
                                                   addValue:20 uValue:10]];
    maxNumList[4] = [NSNumber numberWithInt:
                   [CalculateTool calculateMaxValueByOValue:[maxNumList[4] floatValue]
                                                     tValue:_bone
                                                   addValue:10 uValue:10]];
    maxNumList[5] = [NSNumber numberWithInt:
                   [CalculateTool calculateMaxValueByOValue:[maxNumList[5] floatValue]
                                                     tValue:_mu
                                                   addValue:40 uValue:10]];
    maxNumList[6] = [NSNumber numberWithInt:
                   [CalculateTool calculateMaxValueByOValue:[maxNumList[6] floatValue]
                                                     tValue:_water
                                                   addValue:40 uValue:10]];
    maxNumList[7] = [NSNumber numberWithInt:
                   [CalculateTool calculateMaxValueByOValue:[maxNumList[7] floatValue]
                                                     tValue:_bmr
                                                   addValue:600 uValue:100]];
    maxNumList[8] = [NSNumber numberWithInt:
                   [CalculateTool calculateMaxValueByOValue:[maxNumList[8] floatValue]
                                                     tValue:_eBmr
                                                   addValue:600 uValue:100]];
    maxNumList[9] = [NSNumber numberWithInt:
                   [CalculateTool calculateMaxValueByOValue:[maxNumList[9] floatValue]
                                                     tValue:_o
                                                   addValue:20 uValue:10]];
    maxNumList[10]= [NSNumber numberWithInt:
                   [CalculateTool calculateMaxValueByOValue:[maxNumList[10] floatValue]
                                                     tValue:_bAge
                                                   addValue:20 uValue:10]];
     */
    
}


+(void)calculateMaxNumber:(NSMutableArray *)maxNumList
                MinNumber:(NSMutableArray *)minNumList
                  numbers:(NSArray *)numberList
{
    /*  默认值 同时也是 修正值 */
    NSArray *_aryD = @[@0,@0,@0,
                       @0,@0,@0,
                       @0,@0,@0,
                       @0,@0 ];

    
    for (int i = 0; i < _aryD.count; i++) {
        maxNumList[i] = [NSNumber numberWithInt:
                         [CalculateTool calculateMaxValueByOValue:[maxNumList[i] floatValue]
                                                           tValue:[numberList[i] floatValue] ] ];
    }
    
}

#pragma mark - 体征计算 块开始
/**
 *  计算体征数据
 *
 *  @param userData 测量数据
 *  @param height   用户身高
 *  @param age      用户真实年龄
 *  @param sex      用户性别
 *  @param uid      用户uid
 *
 *  @return PCEntity对象元素数组 11项体征，11个元素
 */
+(NSArray *)calculatePhysicalCharacteristics:(UserDataEntity *)userData
                                      height:(float)height
                                         age:(int)age
                                         sex:(int)sex
                                         uid:(NSString *)uid
{
    if (!userData) {
        
        NSArray *_ary = @[
                          [CalculateTool calculatePC_weight:0
                                                      lastW:0
                                                        bmi:0
                                                     height:height/100.0],
                          [CalculateTool calculatePC_bmi:0
                                                 lastBmi:0],
                          [CalculateTool calculatePC_fat:0
                                                 lastfat:0
                                                     sex:sex
                                                     age:age],
                          [CalculateTool calculatePC_water:0
                                                 lastwater:0
                                                       sex:sex
                                                       age:age],
                          
                          [CalculateTool calculatePC_muscle:0
                                                 lastmuscle:0
                                                     height:height
                                                        sex:sex],
                          [CalculateTool calculatePC_bone:0
                                                 lastbone:0
                                                      sex:sex
                                                   weight:0],
                          
                          
                          [CalculateTool calculatePC_bmr:0
                                                 lastbmr:0
                                                  weight:0
                                                     age:age
                                                     sex:sex isAsia:1],
                          [CalculateTool calculatePC_bmr:0
                                                 lastbmr:0
                                                  weight:0
                                                     age:age
                                                     sex:sex
                                                  isAsia:0],
                          
                          [CalculateTool calculatePC_skin:0
                                                 lastskin:0
                                                      sex:sex],
                          [CalculateTool calculatePC_offal:0
                                                 lastoffal:0],
                          [CalculateTool calculatePC_bodyage:0
                                                 lastbodyage:0
                                                         age:age]
                          
                          ];
        
        return _ary;
    }
    
    
    float _bmi      = [[CalculateTool inputStr:userData.UD_BMI] floatValue];
    float _weight   = [[CalculateTool inputStr:userData.UD_WEIGHT] floatValue];
    float _fat      = [[CalculateTool inputStr:userData.UD_FAT] floatValue];
    float _skin     = [[CalculateTool inputStr:userData.UD_SKINFAT] floatValue];
    float _offal    = [[CalculateTool inputStr:userData.UD_OFFALFAT] floatValue];
    float _muscle   = [[CalculateTool inputStr:userData.UD_MUSCLE] floatValue];
    
    float _eBmr     = [CalculateTool calculateEuropaBmrByFat:_fat weight:_weight];
    float _bmr      = [[CalculateTool inputStr:userData.UD_METABOLISM] floatValue];
    
    float _bone     = [[CalculateTool inputStr:userData.UD_BONE] floatValue];
    float _water    = [[CalculateTool inputStr:userData.UD_WATER] floatValue];
    int _bodyage    = [[CalculateTool inputStr:userData.UD_BODYAGE] intValue];
    

    
    
    
    
    UserDataEntity *_lastData = [[DatabaseService defaultDatabaseService]
                                                    getUserDataByUid:uid num:2];
    /* 若第二条数据不存在，则填充为第一条数据内容 */
    if (!_lastData) {
        _lastData = [[UserDataEntity alloc]init];
        _lastData.UD_WEIGHT     = userData.UD_WEIGHT;
        _lastData.UD_WATER      = userData.UD_WATER;
        _lastData.UD_SKINFAT    = userData.UD_SKINFAT;
        _lastData.UD_STATUS     = userData.UD_STATUS;
        _lastData.UD_BMI        = userData.UD_BMI;
        
        _lastData.UD_BODYAGE    = userData.UD_BODYAGE;
        _lastData.UD_BONE       = userData.UD_BONE;
        _lastData.UD_METABOLISM = userData.UD_METABOLISM;
        _lastData.UD_MUSCLE     = userData.UD_MUSCLE;
        _lastData.UD_OFFALFAT   = userData.UD_OFFALFAT;
        
        _lastData.UD_FAT        = userData.UD_FAT;
        
    }
    

    NSArray *_ary = @[
      [CalculateTool calculatePC_weight:_weight
                         lastW:[[CalculateTool inputStr:_lastData.UD_WEIGHT] floatValue]
                           bmi:_bmi
                        height:height/100.0],
      [CalculateTool calculatePC_bmi:_bmi
                    lastBmi:[[CalculateTool inputStr:_lastData.UD_BMI] floatValue]],
      [CalculateTool calculatePC_fat:_fat
                    lastfat:[[CalculateTool inputStr:_lastData.UD_FAT] floatValue]
                        sex:sex
                        age:age],
      [CalculateTool calculatePC_water:_water
                             lastwater:[[CalculateTool inputStr:_lastData.UD_WATER] floatValue]
                                   sex:sex
                                   age:age],
      
      
      [CalculateTool calculatePC_muscle:_muscle
                             lastmuscle:[[CalculateTool inputStr:_lastData.UD_MUSCLE] floatValue]
                                 height:height
                                    sex:sex],
      [CalculateTool calculatePC_bone:_bone
                    lastbone:[[CalculateTool inputStr:_lastData.UD_BONE] floatValue]
                         sex:sex
                      weight:_weight],
      
      
      
      
      [CalculateTool calculatePC_bmr:_bmr
                    lastbmr:[[CalculateTool inputStr:_lastData.UD_METABOLISM] floatValue]
                     weight:_weight
                        age:age
                        sex:sex isAsia:1],
      [CalculateTool calculatePC_bmr:_eBmr
                             lastbmr:[CalculateTool calculateEuropaBmrByFat:[[CalculateTool inputStr:_lastData.UD_FAT] floatValue]
                                                                     weight:[[CalculateTool inputStr:_lastData.UD_WEIGHT] floatValue]]
                              weight:_weight
                                 age:age
                                 sex:sex isAsia:0],
      
      
      [CalculateTool calculatePC_skin:_skin
                             lastskin:[[CalculateTool inputStr:_lastData.UD_SKINFAT] floatValue]
                                  sex:sex],
      [CalculateTool calculatePC_offal:_offal
                    lastoffal:[[CalculateTool inputStr:_lastData.UD_OFFALFAT] floatValue]],
      [CalculateTool calculatePC_bodyage:_bodyage
                    lastbodyage:[[CalculateTool inputStr:_lastData.UD_BODYAGE] floatValue]
                                     age:age]
                      
    ];
    //NSLog(@">>>>>>>>>>>>>>>>>>>>>>>>>>>>");

    return _ary;
}




+(NSArray *)calculatePhysicalCharacteristicsByData:(UserDataEntity *)userData
{
    
    
    UserInfoEntity *_user = [GloubleProperty sharedInstance].currentUserEntity;
    
    if (!_user) {
        return @[];
    }
    
    float _height   = [[CalculateTool inputStr:_user.UI_height] floatValue];
    int _age        = [[CalculateTool inputStr:_user.UI_age] intValue];
    int _sex        = [[CalculateTool inputStr:_user.UI_sex] intValue];
    NSString *_uid  = [CalculateTool inputStr:_user.UI_userId];
    
    return [CalculateTool calculatePhysicalCharacteristics:userData
                                                    height:_height
                                                       age:_age
                                                       sex:_sex
                                                       uid:_uid];
}

+(NSArray *)calculatePhysicalCharacteristicsByData:(UserDataEntity *)userData
                                    withUserEnitty:(UserInfoEntity *)userInfo
{
    
    
    UserInfoEntity *_user = userInfo;
    
    if (!_user) {
        return @[];
    }
    
    float _height   = [[CalculateTool inputStr:_user.UI_height] floatValue];
    int _age        = [[CalculateTool inputStr:_user.UI_age] intValue];
    int _sex        = [[CalculateTool inputStr:_user.UI_sex] intValue];
    NSString *_uid  = [CalculateTool inputStr:_user.UI_userId];
    
    return [CalculateTool calculatePhysicalCharacteristics:userData
                                                    height:_height
                                                       age:_age
                                                       sex:_sex
                                                       uid:_uid];
}






#pragma mark *分支
+(PCEntity *)calculatePC_weight:(float)oW
                          lastW:(float)lW
                            bmi:(float)bmi
                         height:(float)height
{
    float _hSQ      = height * height;
    
    PCEntity *_pce      = [[PCEntity alloc]init];
    _pce.pc_tp          = PCType_weight;
    _pce.pc_deltaValue  = oW - lW;
    _pce.pc_originValue = oW;
    if (bmi < 18.5) {
        _pce.pc_description = @"偏瘦";
    }else if (bmi >= 18.5 && bmi < 24){
        _pce.pc_description = @"标准";
    }else if (bmi >= 24 && bmi < 28){
        _pce.pc_description = @"超重";
    }else if (bmi >= 28){
        _pce.pc_description = @"肥胖";
    }
    if ([@"标准" isEqualToString:_pce.pc_description]) {
        _pce.pc_status = YES;
    }else{
        _pce.pc_status = NO;
    }
    //NSLog(@"weight:%@",_pce.pc_description);
    
    
    if (_hSQ == 0) {
        _pce.pc_filedPointList = @[@5.0,@150.0];
    }
    else{
        float _p1 = 18.5 * _hSQ;
        float _p2 = 24.0 * _hSQ;
        float _p3 = 28.0 * _hSQ;
        
        if (_p1 > 5 && _p3 < 150) {
            _pce.pc_filedPointList = @[
                                       @5.0,
                                       [NSNumber numberWithFloat: _p1],
                                       [NSNumber numberWithFloat: _p2],
                                       [NSNumber numberWithFloat: _p3],
                                       @150.0
                                       ];
        }else{
        
            _pce.pc_filedPointList = @[@5.0,@150.0];
        }
        
    }
    
    

    
    return _pce;
}


+(PCEntity *)calculatePC_bmi:(float)oBmi
                     lastBmi:(float)lBmi
{
    PCEntity *_pce      = [[PCEntity alloc]init];
    _pce.pc_tp          = PCType_bmi;
    _pce.pc_deltaValue  = oBmi - lBmi;
    _pce.pc_originValue = oBmi;
    if (oBmi < 18.5) {
        _pce.pc_description = @"偏瘦";
    }else if (oBmi >= 18.5 && oBmi < 24){
        _pce.pc_description = @"标准";
    }else if (oBmi >= 24 && oBmi < 28){
        _pce.pc_description = @"超重";
    }else if (oBmi >= 28){
        _pce.pc_description = @"肥胖";
    }
    
    if ([@"标准" isEqualToString:_pce.pc_description]) {
        _pce.pc_status = YES;
    }else{
        _pce.pc_status = NO;
    }
    //NSLog(@"bmi:%@",_pce.pc_description);
    _pce.pc_filedPointList = @[
                               @10.0,
                               @18.5,
                               @24.0,
                               @28.0,
                               @40.0
                               ];
    
    return _pce;
}


+(PCEntity *)calculatePC_fat:(float)oFat
                     lastfat:(float)lFat
                         sex:(int)sex
                         age:(int)age
{
    PCEntity *_pce      = [[PCEntity alloc]init];
    _pce.pc_tp          = PCType_fat;
    _pce.pc_deltaValue  = oFat - lFat;
    _pce.pc_originValue = oFat;
    NSArray  *_fatFiledList = @[@5.0,@75.0];
    NSString *_fatStr = @"";
    if (sex) {
        if (age > 30) {
            if (oFat < 16) {
                _fatStr = @"偏瘦";
            }else if (oFat >= 16 && oFat < 23){
                _fatStr = @"标准";
            }else if (oFat >= 23 && oFat < 25){
                _fatStr = @"超重";
            }else if (oFat >= 25){
                _fatStr = @"肥胖";
            }
            _fatFiledList = @[@5.0,
                              @16.0,
                              @23.0,
                              @25.0,
                              @75.0];
        }else{
            if (oFat < 13) {
                _fatStr = @"偏瘦";
            }else if (oFat >= 13 && oFat < 21){
                _fatStr = @"标准";
            }else if (oFat >= 21 && oFat < 25){
                _fatStr = @"超重";
            }else if (oFat >= 25){
                _fatStr = @"肥胖";
            }
            _fatFiledList = @[@5.0,
                              @13.0,
                              @21.0,
                              @25.0,
                              @75.0];
        }
    }
    else{
        if (age > 30) {
            if (oFat < 19) {
                _fatStr = @"偏瘦";
            }else if (oFat >= 19 && oFat < 27){
                _fatStr = @"标准";
            }else if (oFat >= 27 && oFat < 30){
                _fatStr = @"超重";
            }else if (oFat >= 30){
                _fatStr = @"肥胖";
            }
            _fatFiledList = @[@5.0,
                              @19.0,
                              @27.0,
                              @30.0,
                              @75.0];
        }
        else{
            if (oFat < 16) {
                _fatStr = @"偏瘦";
            }else if (oFat >= 16 && oFat < 23){
                _fatStr = @"标准";
            }else if (oFat >= 23 && oFat < 30){
                _fatStr = @"超重";
            }else if (oFat >= 30){
                _fatStr = @"肥胖";
            }
            _fatFiledList = @[@5.0,
                              @16.0,
                              @23.0,
                              @30.0,
                              @75.0];
        }
    }
    
    _pce.pc_filedPointList  = _fatFiledList;
    _pce.pc_description     = _fatStr;
    if ([@"标准" isEqualToString:_pce.pc_description]) {
        _pce.pc_status = YES;
    }else{
        _pce.pc_status = NO;
    }
    //NSLog(@"Fat:%@",_pce.pc_description);
    
    return _pce;
}

+(PCEntity *)calculatePC_skin:(float)oSkin
                     lastskin:(float)lSkin
                         sex:(int)sex
{
    PCEntity *_pce      = [[PCEntity alloc]init];
    _pce.pc_tp          = PCType_skin;
    _pce.pc_deltaValue  = oSkin - lSkin;
    _pce.pc_originValue = oSkin;
    
    NSArray *_fpList = @[@5.0,@60.0];
    NSString *_skinStr = @"";
    if (sex) {
        if (oSkin < 8.6) {
            _skinStr = @"偏低";
        }else if (oSkin >= 8.6 && oSkin < 16.7){
            _skinStr = @"标准";
        }else if (oSkin >= 16.7){
            _skinStr = @"偏高";
        }
        _fpList = @[@5.0,@8.6,@16.7,@60.0];
    }
    else{
        if (oSkin < 18.5) {
            _skinStr = @"偏低";
        }else if (oSkin >= 18.5 && oSkin < 26.7){
            _skinStr = @"标准";
        }else if (oSkin >= 26.7){
            _skinStr = @"偏高";
        }
        _fpList = @[@5.0,@18.5,@26.7,@60.0];
    }
    
    _pce.pc_filedPointList  = _fpList;
    _pce.pc_description     = _skinStr;
    
    if ([@"标准" isEqualToString:_pce.pc_description]) {
        _pce.pc_status = YES;
    }else{
        _pce.pc_status = NO;
    }
    //NSLog(@"Skin:%@",_pce.pc_description);
    
    return _pce;
}

+(PCEntity *)calculatePC_offal:(float)oOffal
                     lastoffal:(float)lOffal
{
    PCEntity *_pce      = [[PCEntity alloc]init];
    _pce.pc_tp          = PCType_offal;
    _pce.pc_deltaValue  = oOffal - lOffal;
    _pce.pc_originValue = oOffal;
    
    NSString *_offalStr = @"";
    if (oOffal < 10) {
        _offalStr = @"标准";
    }
    else if (oOffal >= 10 && oOffal <= 15)
    {
        _offalStr = @"偏高";
    }
    else if (oOffal > 15)
    {
        _offalStr = @"过高";
    }
    
    _pce.pc_filedPointList  = @[@1,@10,@15,@30];
    _pce.pc_description     = _offalStr;
    
    if ([@"标准" isEqualToString:_pce.pc_description]) {
        _pce.pc_status = YES;
    }else{
        _pce.pc_status = NO;
    }
    //NSLog(@"Offal:%@",_pce.pc_description);
    
    return _pce;
}


+(PCEntity *)calculatePC_muscle:(float)oMuscle
                     lastmuscle:(float)lMuscle
                         height:(float)height
                            sex:(int)sex

{
    PCEntity *_pce      = [[PCEntity alloc]init];
    _pce.pc_tp          = PCType_muscle;
    
    _pce.pc_deltaValue  = oMuscle - lMuscle;
    _pce.pc_originValue = oMuscle;
    
    NSArray *_fpList = @[@25,@75];
    NSString *_muscleStr = @"";
    if (sex) {
        
        float _minM = 0;
        float _maxM = 0;
        
        if (height <= 160) {
            
            _minM   = 42.5 - 4;
            _maxM   = 42.5 + 4;
            
            if (oMuscle < _minM) {
                _muscleStr = @"偏低";
            }
            else if (oMuscle >= _minM && oMuscle <= _maxM)
            {
                _muscleStr = @"标准";
            }
            else if (oMuscle > _maxM)
            {
                _muscleStr = @"偏高";
            }
            
        }
        else if (height > 160 && height <= 170){
            
            _minM = 48.2 - 4.2;
            _maxM = 48.2 + 4.2;
            
            
            if (oMuscle < _minM) {
                
                _muscleStr = @"偏低";
                
            }
            else if (oMuscle >= _minM && oMuscle <= _maxM)
            {
                _muscleStr = @"标准";
            }
            else if (oMuscle > _maxM)
            {
                _muscleStr = @"偏高";
            }
            
        }
        else if (height > 170){

            _minM = 54.4 - 5;
            _maxM = 54.4 + 5;
            
            
            if (oMuscle < _minM) {
                
                _muscleStr = @"偏低";
                
            }
            else if (oMuscle >= _minM && oMuscle <= _maxM)
            {
                _muscleStr = @"标准";
            }
            else if (oMuscle > _maxM)
            {
                _muscleStr = @"偏高";
            }
            
        }
        
        _fpList = @[@25,
                    [NSNumber numberWithFloat:_minM],
                    [NSNumber numberWithFloat:_maxM],
                    @75];
    }
    else{
        
        float _minM = 0;
        float _maxM = 0;
        
        if (height <= 150) {
            
            _minM = 31.9 - 2.8;
            _maxM = 31.9 + 2.8;

            if (oMuscle < _minM) {
                
                _muscleStr = @"偏低";
                
            }
            else if (oMuscle >= _minM && oMuscle <= _maxM)
            {
                _muscleStr = @"标准";
            }
            else if (oMuscle > _maxM)
            {
                _muscleStr = @"偏高";
            }
            
        }
        else if (height > 150 && height <= 160){
            
            _minM = 35.2 - 2.3;
            _maxM = 35.2 + 2.3;
            
            
            if (oMuscle < _minM) {
                
                _muscleStr = @"偏低";
                
            }
            else if (oMuscle >= _minM && oMuscle <= _maxM)
            {
                _muscleStr = @"标准";
            }
            else if (oMuscle > _maxM)
            {
                _muscleStr = @"偏高";
            }
            
        }
        else if (height > 160){

            _minM = 39.5 - 3;
            _maxM = 39.5 + 3;
            
            
            if (oMuscle < _minM) {
                
                _muscleStr = @"偏低";
                
            }
            else if (oMuscle >= _minM && oMuscle <= _maxM)
            {
                _muscleStr = @"标准";
            }
            else if (oMuscle > _maxM)
            {
                _muscleStr = @"偏高";
            }
            
        }
        
        _fpList = @[@25,
                    [NSNumber numberWithFloat:_minM],
                    [NSNumber numberWithFloat:_maxM],
                    @75];
        
    }
    
    _pce.pc_filedPointList  = _fpList;
    _pce.pc_description     = _muscleStr;
    
    if ([@"标准" isEqualToString:_pce.pc_description]) {
        _pce.pc_status = YES;
    }else{
        _pce.pc_status = NO;
    }
    //NSLog(@"Muscle:%@",_pce.pc_description);
    return _pce;
}


/*int*/
+(PCEntity *)calculatePC_bmr:(float)oBmr
                     lastbmr:(float)lBmr
                      weight:(float)weight
                         age:(int)age
                         sex:(int)sex
                      isAsia:(int)isAsia
{
    PCEntity *_pce      = [[PCEntity alloc]init];
    _pce.pc_tp          = isAsia ? PCType_bmr : PCType_eBmr;
    _pce.pc_deltaValue  = oBmr - lBmr;
    _pce.pc_originValue = (int)oBmr;
    
    NSString *_bmrStr   = @"";
    float _standard     = 0;
    
    if (isAsia) {

        if (age <= 11
        ) {
            if (sex) {
                _standard = 1330;
            }else{
                _standard = 1200;
            }
        }
        else if (age >= 12 &&
                 age <= 14
                 ) {
            if (sex) {
                _standard = 1490;
            }else{
                _standard = 1360;
            }
        }
        else if (age >= 15 &&
                 age <= 17
                 ) {
            if (sex) {
                _standard = 1580;
            }else{
                _standard = 1280;
            }
        }
        else if (age >= 18 &&
                 age <= 29
                 ) {
            if (sex) {
                _standard = 1510;
            }else{
                _standard = 1120;
            }
        }
        else if (age >= 30 &&
                 age <= 49
                 ) {
            if (sex) {
                _standard = 1530;
            }else{
                _standard = 1150;
            }
        }
        else if (age >= 50 &&
                 age <= 69
                 ) {
            if (sex) {
                _standard = 1400;
            }else{
                _standard = 1110;
            }
        }
        else if (age >= 70 ) {
            if (sex) {
                _standard = 1280;
            }else{
                _standard = 1010;
            }
        }
        
    }
    else{
        if (age >= 10 && age < 18)
        {
            _standard = 17.5 * weight + 651;
            
        }
        else if (age >= 18 && age < 30)
        {
            _standard = 15.3 * weight + 679;
            
        }
        else if (age >= 30)
        {
            _standard = 11.6 * weight + 879;
            
        }
    }
    
    if (oBmr < _standard) {
        _bmrStr = @"未达标";
    }else{
        _bmrStr = @"达标";
    }
    
    _pce.pc_filedPointList  = @[[NSNumber numberWithFloat:(_standard - 500)],
                                [NSNumber numberWithFloat:_standard],
                                [NSNumber numberWithFloat:(_standard + 500)]
                                ];
    
    _pce.pc_description     = _bmrStr;
    
    if ([@"达标" isEqualToString:_pce.pc_description]) {
        _pce.pc_status = YES;
    }else{
        _pce.pc_status = NO;
    }
    //NSLog(@"Bmr:%@",_pce.pc_description);
    return _pce;
}

+(PCEntity *)calculatePC_bone:(float)oBone
                     lastbone:(float)lBone
                          sex:(int)sex
                       weight:(float)weight
{
    
    PCEntity *_pce      = [[PCEntity alloc]init];
    
    _pce.pc_tp          = PCType_boneWeight;
    _pce.pc_deltaValue  = oBone - lBone;
    _pce.pc_originValue = oBone;
    
    NSArray *_fpList    = @[@0.1,@10];
    NSString *_boneStr = @"";
    
    float _boneNum = oBone * weight / 100.0;
    
    
    if (sex) {
        if (_boneNum  < 3.1) {
            _boneStr = @"偏低";
        }
        else if (_boneNum >= 3.1 && _boneNum <= 3.3){
            _boneStr = @"标准";
        }
        else if (_boneNum > 3.3) {
            _boneStr = @"偏高";
        }
        
        
        if (weight == 0) {
            _fpList    = @[@0.1,@10];
        }
        else{
            
            float _p1 = 3.1 * 100 / weight;
            float _p2 = 3.3 * 100 / weight;
            
            
            if (_p1 > 0.1 && _p2 < 10) {
                _fpList = @[
                            @0.1,
                            [NSNumber numberWithFloat:_p1],
                            [NSNumber numberWithFloat:_p2],
                            @10
                            ];
            }
            else{
                _fpList    = @[@0.1,@10];
            }
            

        }
        
    }
    else{
        if (_boneNum < 2.4) {
            _boneStr = @"偏低";
        }
        else if (_boneNum >= 2.4 && _boneNum <= 2.6){
            _boneStr = @"标准";
        }
        else if (_boneNum > 2.6) {
            _boneStr = @"偏高";
        }
        
        
        if (weight == 0) {
            _fpList    = @[@0.1,@10];
        }
        else{
            
            float _p1 = 2.4 * 100 / weight;
            float _p2 = 2.6 * 100 / weight;
            
            
            if (_p1 > 0.1 && _p2 < 10) {
                _fpList = @[
                            @0.1,
                            [NSNumber numberWithFloat:_p1],
                            [NSNumber numberWithFloat:_p2],
                            @10
                            ];
            }
            else{
                _fpList    = @[@0.1,@10];
            }
            
            
        }
    }
    
    _pce.pc_filedPointList  = _fpList;
    _pce.pc_description     = _boneStr;
    if ([@"标准" isEqualToString:_pce.pc_description]) {
        _pce.pc_status = YES;
    }else{
        _pce.pc_status = NO;
    }
    //NSLog(@"Bone:%@",_pce.pc_description);
    return _pce;
}

+(PCEntity *)calculatePC_water:(float)oWater
                     lastwater:(float)lWater
                          sex:(int)sex
                          age:(int)age
{
    
    PCEntity *_pce      = [[PCEntity alloc]init];
    
    _pce.pc_tp          = PCType_water;
    _pce.pc_deltaValue  = oWater - lWater;
    _pce.pc_originValue = oWater;
    
    NSArray *_fpList = @[@10,@80];
    NSString *_waterStr = @"";
    if (sex) {
        if (age > 30) {
            if (oWater < 53.3) {
                _waterStr = @"偏低";
            }else if (oWater >= 53.3 && oWater <= 55.6){
                _waterStr = @"标准";
            }else if (oWater > 55.6){
                _waterStr = @"偏高";
            }
            _fpList = @[@10,@53.3,@55.6,@80];
        }else{
            if (oWater < 53.6) {
                _waterStr = @"偏低";
            }else if (oWater >= 53.6 && oWater <= 57){
                _waterStr = @"标准";
            }else if (oWater > 57){
                _waterStr = @"偏高";
            }
            _fpList = @[@10,@53.6,@57,@80];
        }
    }
    else{
        if (age > 30) {
            if (oWater < 48.1) {
                _waterStr = @"偏低";
            }else if (oWater >= 48.1 && oWater <= 51.5){
                _waterStr = @"标准";
            }else if (oWater > 51.5){
                _waterStr = @"偏高";
            }
            _fpList = @[@10,@48.1,@51.5,@80];
        }else{
            if (oWater < 49.5) {
                _waterStr = @"偏低";
            }else if (oWater >= 49.5 && oWater <= 52.9){
                _waterStr = @"标准";
            }else if (oWater > 52.9){
                _waterStr = @"偏高";
            }
            _fpList = @[@10,@49.5,@52.9,@80];
        }
    }
    
    _pce.pc_filedPointList = _fpList;
    _pce.pc_description = _waterStr;
    if ([@"标准" isEqualToString:_pce.pc_description]) {
        _pce.pc_status = YES;
    }else{
        _pce.pc_status = NO;
    }
    //NSLog(@"water:%@",_pce.pc_description);
    return _pce;
}

/*int*/
+(PCEntity *)calculatePC_bodyage:(float)oBodyage
                     lastbodyage:(float)lBodyage
                             age:(int)age
{
    
    PCEntity *_pce      = [[PCEntity alloc]init];
    
    _pce.pc_tp          = PCType_bodyage;
    _pce.pc_deltaValue  = oBodyage - lBodyage;
    _pce.pc_originValue = (int)oBodyage;
    
    _pce.pc_filedPointList = @[@18,[NSNumber numberWithInt:age],@80];
    _pce.pc_description = @"";
    if (oBodyage <= age) {
        _pce.pc_status = YES;
    }else{
        _pce.pc_status = NO;
    }
    //NSLog(@"bodyage:%f,age:%d",oBodyage,age);
    return _pce;
}


+(float)calculateEuropaBmrByFat:(float)fat
                         weight:(float)weight
{
    if (weight == 0 || fat == 0) {
        return 0;
    }
    
    float _lbm  = (100 - fat) * weight / 100.0;
    float _p    = 370 + (21.6 * _lbm);
    
    return _p;
}


/**
 *  计算上限值
 *
 *  @param oValue 原值
 *  @param tValue 目标值
 *  @param aValue 修正值
 *
 *  @return 结果值
 */
+(int)calculateMaxValueByOValue:(float)oValue
                         tValue:(float)tValue
                       addValue:(float)aValue
                         uValue:(int)uValue
{
    int _result = oValue;
    if (tValue + aValue > oValue) {
        int _wM = (int)(tValue / uValue);
        if (tValue > _wM * uValue) {
            _result = (_wM + 1) * uValue + aValue;
        }
        else{
            _result = _wM * uValue + aValue;
        }
    }
    
    return _result;
}



+(float)calculateMaxValueByOValue:(float)oValue
                         tValue:(float)tValue
{
    float _result = oValue;
    if (tValue > oValue) {
        //_result = ceilf(tValue);
        _result = tValue;
    }
    
    return _result;
}


+(float)calculateMinValueByOValue:(float)oValue
                         tValue:(float)tValue
{
    float _result = oValue;
    if (tValue < oValue) {
        //_result = floorf(tValue);
        _result = tValue;
    }
    
    return _result;
}



#pragma mark 体征计算 块结束




@end
